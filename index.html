<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Baghdad: High-Fidelity Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1814; font-family: 'Cinzel', serif; }
        #boot { position: fixed; inset: 0; display: flex; flex-direction: column; justify-content: center; 
                align-items: center; background: #0b0a09; z-index: 100; color: #d4af37; transition: 0.8s; }
        button { padding: 20px 50px; background: none; border: 2px solid #d4af37; color: #d4af37; 
                 font-size: 1.5rem; cursor: pointer; letter-spacing: 5px; font-family: 'Cinzel'; }
        button:hover { background: #d4af37; color: #000; }
        #ui { position: fixed; top: 20px; left: 20px; color: #d4af37; pointer-events: none; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet">
</head>
<body>
    <div id="boot">
        <h1 style="letter-spacing:15px;">BAGHDAD</h1>
        <p style="color: #6d5f4f;">CENTRE OF THE ABBASID CALIPHATE</p>
        <button onclick="launch()">INITIALISE CHRONICLE</button>
    </div>
    <div id="ui"><b>Mouse:</b> Orbit | <b>Scroll:</b> Zoom</div>

    <script type="importmap">
        { "imports": { "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.module.min.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';

        let scene, camera, renderer, controls, audio;

        window.launch = () => {
            // LOAD ACTUAL MP3 FILE
            audio = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3'); 
            audio.loop = true;
            audio.volume = 0.7; // Loud
            audio.play();

            document.getElementById('boot').style.opacity = '0';
            setTimeout(() => document.getElementById('boot').remove(), 800);
            init();
        };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe8dcc0); // SUN-DRENCHED DAY

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.set(1200, 800, 1200); 

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // HARSH DESERT SUN
            const sun = new THREE.DirectionalLight(0xffffff, 2.5);
            sun.position.set(500, 1000, 500);
            scene.add(sun, new THREE.AmbientLight(0xffffff, 0.5));

            // THE TIGRIS RIVER
            const river = new THREE.Mesh(
                new THREE.PlaneGeometry(5000, 400),
                new THREE.MeshStandardMaterial({ color: 0x1a2a30, roughness: 0.2 })
            );
            river.rotation.x = -Math.PI / 2;
            river.position.y = -1;
            scene.add(river);

            // THE CITY (Simplified for performance)
            const count = 3500;
            const city = new THREE.InstancedMesh(
                new THREE.BoxGeometry(20, 1, 20), 
                new THREE.MeshStandardMaterial({ color: 0x8b7355 }), 
                count
            );
            
            const dummy = new THREE.Object3D();
            for (let i = 0; i < count; i++) {
                const r = 250 + Math.random() * 900;
                const a = Math.random() * Math.PI * 2;
                const x = Math.cos(a) * r;
                const z = Math.sin(a) * r;
                
                if (Math.abs(z) < 220) continue; 

                dummy.position.set(x, 0, z);
                dummy.scale.y = 20 + Math.random() * 60;
                dummy.position.y = dummy.scale.y / 2;
                dummy.updateMatrix();
                city.setMatrixAt(i, dummy.matrix);
            }
            scene.add(city);

            // CENTRAL GOLDEN DOME
            const palace = new THREE.Group();
            palace.add(new THREE.Mesh(new THREE.CylinderGeometry(70, 70, 80, 8), new THREE.MeshStandardMaterial({color: 0x9c8263})));
            const dome = new THREE.Mesh(new THREE.SphereGeometry(70, 32, 16, 0, 6.3, 0, 1.6), new THREE.MeshStandardMaterial({color: 0xd4af37, metalness: 0.8, roughness: 0.1}));
            dome.position.y = 40;
            palace.add(dome);
            scene.add(palace);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
